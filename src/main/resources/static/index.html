<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>üî• –î–µ–Ω—å 5 ‚Äî –í–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–µ–π (HF Router)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --bd:#e5e7eb; --fg:#111827; --mut:#6b7280; --bg:#ffffff; --acc:#0b6; }
    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg); color: var(--fg); font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .wrap { max-width: 1100px; margin: 30px auto; padding: 0 16px; }
    h1 { margin: 0 0 8px; font-size: 22px; }
    .hint { color: var(--mut); margin: 0 16px 16px; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .card { border: 1px solid var(--bd); border-radius: 12px; padding: 12px; background: #fff; min-height: 260px; display: flex; flex-direction: column; }
    .head { display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom: 8px; }
    .model { font-weight: 600; font-size: 14px; color: var(--fg); }
    .metrics { color: var(--mut); font-size: 12px; line-height: 1.4; }
    .log { border: 1px solid var(--bd); border-radius: 10px; padding: 10px; background: #fafafa; flex:1; white-space: pre-wrap; overflow:auto; }
    .pending { opacity: .7; }
    form { display: flex; gap: 8px; margin: 14px 0; padding: 0 16px; }
    input[type=text] { flex: 1; padding: 12px; border: 1px solid var(--bd); border-radius: 10px; }
    .models { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; padding:0 16px; }
    .models input { width:100%; padding:8px; border:1px solid var(--bd); border-radius:8px; font-size:12px; }
    button { padding: 12px 16px; border: 0; background: var(--acc); color: #fff; border-radius: 10px; cursor: pointer; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .spinner { width: 14px; height: 14px; border: 2px solid #ddd; border-top-color: var(--acc); border-radius: 50%; animation: spin 0.8s linear infinite; display: inline-block; vertical-align: middle; margin-left: 8px; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
<div class="wrap">
  <h1>üî• –î–µ–Ω—å 5 ‚Äî –í–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–µ–π (Hugging Face Router)</h1>
  <p class="hint">–û–¥–∏–Ω –≤–≤–æ–¥ ‚Üí —Ç—Ä–∏ –º–æ–¥–µ–ª–∏ ‚Üí –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ (–≤—Ä–µ–º—è, —Ç–æ–∫–µ–Ω—ã). –î–ª—è Hosted/Router —Ü–µ–Ω–∞ –æ–±—ã—á–Ω–æ N/A.</p>

  <div class="models">
    <input id="m1" value="katanemo/Arch-Router-1.5B:hf-inference">
    <input id="m2" value="HuggingFaceTB/SmolLM3-3B:hf-inference">
    <input id="m3" value="Qwen/Qwen2-7B-Instruct:featherless-ai">
  </div>

  <form id="form" autocomplete="off">
    <input id="msg" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å‚Ä¶ –ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ SMS-–∫–æ–¥—É.¬ª" />
    <button id="send" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </form>

  <div class="grid">
    <div class="card" id="c1">
      <div class="head">
        <div class="model" id="c1m">‚Äì</div>
        <div class="metrics" id="c1x">in:‚Äì | out:‚Äì | total:‚Äì | time:‚Äì ms | cost:N/A</div>
      </div>
      <div class="log" id="c1log">‚Äì</div>
    </div>
    <div class="card" id="c2">
      <div class="head">
        <div class="model" id="c2m">‚Äì</div>
        <div class="metrics" id="c2x">in:‚Äì | out:‚Äì | total:‚Äì | time:‚Äì ms | cost:N/A</div>
      </div>
      <div class="log" id="c2log">‚Äì</div>
    </div>
    <div class="card" id="c3">
      <div class="head">
        <div class="model" id="c3m">‚Äì</div>
        <div class="metrics" id="c3x">in:‚Äì | out:‚Äì | total:‚Äì | time:‚Äì ms | cost:N/A</div>
      </div>
      <div class="log" id="c3log">‚Äì</div>
    </div>
  </div>
</div>

<script>
  const $form = document.getElementById('form');
  const $msg  = document.getElementById('msg');
  const $send = document.getElementById('send');

  const $m1 = document.getElementById('m1');
  const $m2 = document.getElementById('m2');
  const $m3 = document.getElementById('m3');

  const cards = [
    { m: document.getElementById('c1m'), x: document.getElementById('c1x'), log: document.getElementById('c1log'), card: document.getElementById('c1') },
    { m: document.getElementById('c2m'), x: document.getElementById('c2x'), log: document.getElementById('c2log'), card: document.getElementById('c2') },
    { m: document.getElementById('c3m'), x: document.getElementById('c3x'), log: document.getElementById('c3log'), card: document.getElementById('c3') },
  ];

  function setPending(i, on) {
    cards[i].card.classList.toggle('pending', on);
    cards[i].m.textContent  = '‚Ä¶';
    cards[i].x.textContent  = 'in:‚Äì | out:‚Äì | total:‚Äì | time:‚Äì ms | cost:N/A';
    cards[i].log.textContent= on ? '–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶' : cards[i].log.textContent;
  }

  async function send() {
    const text = $msg.value.trim();
    if (!text) return;
    $send.disabled = true;

    [0,1,2].forEach(i => setPending(i, true));
    cards[0].m.textContent = $m1.value;
    cards[1].m.textContent = $m2.value;
    cards[2].m.textContent = $m3.value;

    try {
      const res = await fetch('/multi-chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: text,
          models: [$m1.value, $m2.value, $m3.value]
        })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data?.error || ('HTTP ' + res.status));

      (data.results || []).forEach((r, i) => {
        setPending(i, false);
        cards[i].m.textContent = r.model;
        if (r.error) {
          cards[i].log.textContent = '–û—à–∏–±–∫–∞: ' + r.error;
          cards[i].x.textContent = 'in:‚Äì | out:‚Äì | total:‚Äì | time:' + (r.latencyMs ?? '‚Äì') + ' ms | cost:N/A';
        } else {
          cards[i].log.textContent = r.reply || '(–ø—É—Å—Ç–æ)';
          cards[i].x.textContent = `in:${r.promptTokens} | out:${r.completionTokens} | total:${r.totalTokens} | time:${r.latencyMs} ms | cost:${r.costUsd ?? 'N/A'}`;
        }
      });
    } catch (e) {
      [0,1,2].forEach((i) => {
        setPending(i, false);
        cards[i].log.textContent = '–û—à–∏–±–∫–∞: ' + (e?.message || e);
      });
    } finally {
      $send.disabled = false;
      $msg.focus();
    }
  }

  $form.addEventListener('submit', (e) => {
    e.preventDefault();
    send();
  });
</script>
</body>
</html>
